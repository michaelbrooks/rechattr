$def with (question, newItem=False, responses=dict())
$ newItemClass = 'new-item' if newItem else ''
$ user = web.ctx.auth.current_user()
$ response = user.first_response(question) if user is not None else None
$ currentAnswer = response.answer if response is not None else None
$ answeredClass = 'answered' if currentAnswer is not None else ''
$if question.id in responses:
    $ answerCounts = responses[question.id]
<div class="question $newItemClass $answeredClass"
     data-id="${question.id}"
     data-type="question"
     data-trigger-manual="${'true' if question.trigger_manual else ''}"
     data-trigger-seconds="${question.trigger_seconds}">
    <div class="question-content">
        <div class="question-text"><span class="username muted">@${question.poll.user.username}:</span> ${question.question_text}</div>
        $if user is None:
            $ sign_in_url = urls.sign_in(urls.poll(question.poll))
            <a class="sign-in-button btn btn-small" href="${sign_in_url}">Sign in to respond</a>
        $else:
            <ul class="answer-list">
            $for idx, choice in enumerate(question.get_answer_choices()):
                $ selectedClass = 'selected' if currentAnswer == choice else ''

                <li class="$selectedClass">
                    $if currentAnswer is not None:
                        <span class="count">
                            ${answerCounts[idx] if idx in answerCounts else 0}
                        </span>
                    $else:
                        <label class="radio">
                        <input type="radio" name="question-${question.id}" value="${idx}"/>

                    <span class="answer-text">$choice</span>

                    $if not currentAnswer:
                        </label>
                </li>
            </ul>
    </div>
    $if user is not None:
        <button class="reply-button btn btn-small"><i class="icon-comment"></i> Post Reply</button>
        $if currentAnswer is not None:
            <span class="already-answered"><i class="icon-ok"></i> Answered</span>

</div>