$def with (question, newItem=False)
$ newItemClass = 'new-item' if newItem else ''
$ user = web.ctx.auth.current_user()
$ response = user.first_response(question) if user is not None else None
$ currentAnswer = response.answer if response is not None else None
$ answeredClass = 'answered' if currentAnswer is not None else ''
<div class="question stream-item $newItemClass $answeredClass"
     data-id="${question.id}"
     data-trigger-manual="${'true' if question.trigger_manual else ''}"
     data-trigger-seconds="${question.trigger_seconds}">
    <div class="question-content">
        <div class="question-text">${question.question_text}</div>
        $ notSignedInClass = ''
        $if user is None:
            $ sign_in_url = urls.sign_in(urls.poll(question.poll))
            <a class="sign-in-button btn btn-small" href="${sign_in_url}">Sign in to respond</a>
            $ notSignedInClass='disabled'
        $else:
            <ul class="answer-list">
            $for choice in question.get_answer_choices():
                $ selectedClass = 'selected' if currentAnswer == choice else ''

                <li class="$selectedClass $notSignedInClass">
                    $if currentAnswer:
                        <span class="count">34</span>
                    $else:
                        <label class="radio">
                        <input type="radio" name="question-${question.id}"/>

                    <span class="answer-text">$choice</span>

                    $if not currentAnswer:
                        </label>
                </li>
            </ul>
            <button class="reply-button btn btn-small"><i class="icon-comment"></i> Comment</button>
    </div>
</div>